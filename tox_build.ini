[tox]
envlist = py38-{build,wheel}
skipsdist = True

[testenv]
passenv = *
setenv = CCACHE_DIR = {envdir}/.ccache
allowlist_externals =
    ls
    rm
    bash
    grep
    mkdir
    yarn
commands =
    rm -rf {toxinidir}/build
    python setup.py compile_docs
    build: yarn install --pure-lockfile
    build: yarn build
    build: python -m build --sdist --wheel --no-isolation --skip-dependency-check --outdir {toxinidir}/dist {toxinidir}
    wheel: python -m build --wheel --no-isolation --skip-dependency-check --outdir {toxinidir}/dist {toxinidir}
deps =
    -rrequirements-doc.txt
    vstcompile~=2.0
    cython>=3.0.0
    build~=0.10.0
    wheel==0.31.1
    setuptools>=40.8.0
